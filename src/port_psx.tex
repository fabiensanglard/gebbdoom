\begin{wrapfigure}[11]{r}{0.3\textwidth}{
\centering \scaledimage{0.3}{psx_logo.png}}
\end{wrapfigure}
The history of the PlayStation started in 1988 when Nintendo collaborated with Sony to produce a CD-ROM reader add-on for the SNES. Under the terms of the contract, Sony could develop independently for the platform and retained control over the "Super Disc" format -- two unusual concessions on Nintendo's part.\\
\par
 The project moved forward until CES '91 when Sony announced the joint venture called "Play Station". The next day, during the same event, Nintendo announced it had instead partnered with Philips (with much more advantageous terms) much to Sony's surprise. Betrayed and publicly humiliated, Sony attempted to turn to Sega's Board of Directors who promptly vetoed the idea. In a 2013 interview then-Sega CEO Tom Kalinske remembered the board's conclusion.\\
\par
\rawfq{That's a stupid idea, Sony doesn't know how to make hardware. They don't know how to make software either. Why would we want to do this?}\\
\par
They were not wrong. Sony had little experience with gaming. It also had almost no interest in trying either, since most of its involvement so far had relied on one man, Ken Kutaragi. Ever since he had witnessed his daughter play on a Nintendo Famicom, Ken had been advocating for Sony to enter the market. He had even designed Nintendo's audio chip (the SPC700) for their SNES against the advice of Sony VPs.\\
\par
 Despite being considered a risky gamble by other Sony executives, Kutaragi gained the support of Sony CEO Norio Ohga. In June 1992 Ken got the green light to build a gaming system from scratch\footnote{Playstation: Anthology by GREEKS-LINE.}. The "Father of the PlayStation" as he would later be called had to be transfered to the financially separate Sony Music to appease the board but he could set himself to work on what would become the "PlayStation" (without space).\\
\par
There was originally some uncertainty about the architecture which could focus either on 2D sprite graphics or 3D polygon graphics. The success of Sega's Oct 1993 Virtua Fighter in Japanese arcades cleared all doubts\footnote{Source: "How Virtua Fighter Saved PlayStation's Bacon". WIRED. Sept 2012.}: the PSX was going the 3D route.\\
\par
The project would culminate two years later with the creation of Sony Computer Entertainment and a Japanese release on December 3, 1994. It was an instant success selling 100,000 units on day one, 2 million after six months, and 102 million units over its lifetime.\\
\par

\cfullimage{consoles/PSX.png}{Sony PlayStation}

\vspace{-20pt}
\subsubsection{Keys to success}
\par
 Among the numerous good choices, Sony listened to developer feedback and bumped the RAM from 1 to 2 MiB. They adopted a developer-centric attitude where the development cycle was easy, tools updated frequently and downloadable online, with third party technical support. The CD format allowed games to be priced lower and developers did not have to buy cartridges from Sony.\\
 \par
  More importantly, Sony did not censor developers the way Nintendo and Sega did. On top of it all, royalties were lower which improved profitability\footnote{Nintendo could sometimes take up to 20\%.}. "The PlayStation set us free" Kalisto Gaming's CEO would later testify.\\
\par
Sony's stroke of luck was to land Psy-Q, which made the PSX's SDK a programmer's dream. Psygnosis was a UK game company working on the Atari ST, Amiga and SNES. Sony purchased them in early 1993 and tasked them with creating the then-still-secret PlayStation games \textit{Wipeout} and \textit{Destruction Derby} to showcase the PlayStation on launch.\\
\par
Until then, Sony had envisioned development for the PlayStation as being based on dedicated Sony NEWS MW.2 workstations\footnote{"The development system", Next Generation June 1995.}. These were colossal, expensive machines based on the MIPS R4000 and manufactured by Sony. Psygnosis disliked that solution, especially when they compared the development experience to their regular tool (Psy-Q) which was produced by a company called SN Systems.\\

\vspace{-10pt}
\begin{wrapfigure}[10]{r}{0.21\textwidth}{
\centering \scaledimage{0.21}{psyq_logo.png}}
\end{wrapfigure}
Around Christmas '93, SN Systems co-owner Andy Beveridge and Martin Day were given an MW.2 by Psygnosis with a request: Make Psy-Q run on it! The pair worked around the clock and managed to port the GNU toolchain (\cw{cc} compiler, \cw{ld} linker, lib builder \cw{ar}, and \cw{gdb} debugger) to a PC connected to a Sony's MW.2 box and demoed it at CES Las Vegas in early 1994.\\
\par
 Sony loved it and promptly ordered 700 dev kits. At the end of Spring 1994, the devkit hardware was shrunk to two ISA cards (called DTL-H2000) connected to a SCSI drive so there was no need to burn CDs for testing.\\
\vspace{5pt}
\cscaledimage{0.95}{DTL-H2000-CPU1and2.png}{DTL-H2000 2x ISA card devkit. SCSI HDD and CD-ROM burner not shown}
\vspace{-10pt}
\par
Leveraging PCs not only significantly reduced the financial cost to become a developer, it also lowered the barrier to entry since most developers were already familiar with Windows.\\
\par
From September 1993 to June 1995, 500 licensees worldwide jumped on the opportunity to publish on Sony's dream machine\footnote{"Sony's PlayStation game plan", Next Generation June 1995.}. Devs bought both the PSX and its devkit.\\
Programming the PlayStation was an unbelievably pleasant experience. Most programming was done in C while allowing handcrafted assembly if necessary. Psy-Q provided a compiler driver able to take a list of \cw{.c}/\cw{.obj} files and output a PlayStation executable in one keystroke.\\
\par
The PSX programming philosophy was to not make developers juggle with multiple systems. The 1MiB video framebuffer for example could not be accessed by the programmer directly, delegation to the GPU was mandatory. This sample from the PSX Developer Tools summarizes well how much care was taken to lift the burden on programmers.\\
\par
\fq{
The CPU is only involved in giving the dedicated hardware very small amounts of data such as the
display location and the start address for data transmission. Data is transfered via the DMA Controller and consumed by the GPU. The result of this parallel processing is that the CPU can devote almost all of its time to creating drawing command lists.}{PlayStation, Net Yaroze Manual}\\
\par
\rawdrawing{psx_arch}
\par









\fullimage{Sony-PlayStation-SCPH-1000-Motherboard}
\par
\vspace{15pt}
Opening a PlayStation and taking a look at the motherboard reveals no fewer than fifteen chips\footnote{Source: NEXT Generation Issue \#6 June 1995, "Inside the Playstation".}\\
\par
\circled{1}, 32-bit 33MHz R3000 CPU (30 Mips) with  4KiB i-cache and 1KiB d-cache. Also contains the 88 Mips Geometry Transfer Engine (GTE), the DMA Controller and Sony's 80 Mips MDEC video decompression hardware.
\circled{2} Operating System ROM.
\circled{3} GPU.
\circled{4} 2 MiB RAM.
\circled{5} 1 MiB VRAM.
\circled{6} DSP.
\circled{7} 512 KiB DSP RAM.
\circled{8} CD Controller: Contains a CD ROM-XA converter (allowing up to eight simultaneous streams of mixed audio and CD data) and a small amount of buffer RAM.
\circled{9} CD-drive DSP.
\circled{A} 16-bit video digital converter.
\circled{B} Video decoder and encoder (NTSC or PAL) to TV.


\rawdrawing{psx_motherboard}
\par
\begin{wrapfigure}[10]{r}{0.4\textwidth}{
\centering \scaledimage{0.4}{trex.png}}
\end{wrapfigure}
It was initially difficult to convince developers to get on board and work with the PlayStation. On October 27, 1993, Sony gathered 300 developers representing 60 games publishers for a tour-de-force. They were shown the "dino demo"\footnote{Source: "PlayStation: Anthology, p30"} that featured a real-time controllable T-rex dinosaur.\\
\par The demo ran at 50 frames per second at a resolution of 512x256. It processed about 1800 polygons per frame, and drew up to 1300 polygons per frame. Jurassic Park, released in 1993, was still fresh in peoples' memory as a monumental engineering achievement. The breathtaking sight spread rapidly in the gaming community and orders for the SDK soon skyrocketed.
 
 






\subsection{\doom{} on PlayStation}
\doom{} was ported to the PSX by Williams Entertainment. It took a little bit less than a year for a team of five\footnote{Three designers/artists and two programmers.} to port the engine, change the assets, and make everything work with "only" 3 MiB of RAM. The final result is universally considered the best console port with some aspects even outmatching the PC version.\\
\par
Work did not start from scratch. The team leveraged work from the Jaguar version and in particular the simplified maps using fewer textures and walls.\\
\par
\fq{The graphics were reduced: the textures chopped down in size, the sprites, monsters, and weapons reduced in size. [...] Sometimes animations had frames cut.}{Harry Teasley}\\
\par
  The restrictions did not have to be as drastic as for Atari's console. Thanks to the CD-ROM capacity, 59 maps (33 from \doom{} and 26 from \doomii{}) shipped. To compensate for the slow access time and the restricted amount of RAM, each map is stored in its own \cw{WAD} archive. On the other hand, most monsters are present except for the Arch-Vile.\\
\par
\fq{The archvile had twice as many frames of animation as any other monster, and we just couldn't do him justice on the PSX.  Couldn't lose his attack, and couldn't lose his resurrecting power.  He was just too big to include.}{Harry Teasley (Designer) for \cw{doomworld.com}}\\
\par
What may come as a surprise are the improvements over the PC version.\\
\par
Sound was improved thanks to the SPU processor to render reverberation in small rooms. The spectre -- which faked translucency with a Predator-like "shimmering" -- was converted to subtractive blending. Musics were brought up to CD standard (44KHz, 16-bit, stereo).\\
\par
 The most impressive addition was the 16-bit colored lighting achieved by adding a color to sectors and 50/50 blending all textures with it. In some cases this feature was used to improve game mechanics, as seen on the next page where a red light indicates a door that requires the red key. To perfect the illusion, the player hand is colored accordingly.\\
\par


\fullimage{psx_screen_door.png}\\

\fullimage{psx_screen_wall.png}\\
\par


There were many other subtle additions such as animated skies. In the following screenshot, the marine is in Hell and the sky contains gorgeous flame effects.\\
\par
\fullimage{psx_screen_sky.png}\\
\par
The PSX's GPU embodies the trade-off coming with a hardware accelerator where generating graphics is more a matter of managing a tool than crafting each pixels by hand.\\
\par
On the list of changes, the developer has no direct access to the VRAM. Texture transfers are operated via DMA into a free-form 1024x512 16-bit area also hosting the framebuffers (which are called "Display Area"s). Instead of writing a texture mapper, a game developer would find herself writing a VRAM allocator. An other peculiarity is that sprites and textures must have power of two dimensions to improve texture sampling (a 64x64 texture lookup at coordinate \cw{(u,v)} can be optimized as \cw{(u $\ll{}$ 6) + v}).\\
\par
Thanks to 8-bit palette (CLUT) texture support, the GPU is well-suited to replicate the VGA sub-system with a single CLUT used as a global palette. Diminishing light is achieved via per-vertex color blended into a Display Area alike the sector coloring we saw earlier.\\
\par
Despite at its advantages, a particular feature of the GPU almost canceled the port.


\fq{I worked with Aaron Seeler on the Nintendo 64 (which was a fairly different game) and Playstation versions.  Those were the first versions that weren't written "to the metal", since both Sony and Nintendo were forcing (at least third party) developers to write to API instead of just handing them hardware register documentation.  The SGI culture in particular cramped developers at the start, but Nintendo eventually walked it back a bit.\\
\par
Funny story on Playstation development:  Aaron and I started out with a different engine architecture that rendered the world with triangles, since they were fully hardware accelerated.  That worked great on the N64, which had subpixel accurate, perspective correct rendering (that SGI influence), but Playstation had integer coordinate, affine texture mapping, and the big wall and floor triangles looked HORRIBLE.}{John Carmack}\\
\par
Affine Texture Mapping is the process of performing texture mapping in screen space without taking perspective into account. Thanks to user \cw{Lollie} from \cw{doomworld.com} we can take a look at what \doom{} could have looked like with improper texturing.\\
\par
\fullimage{affine_texture_mapping/hallway.png}\\
\par
The issue is particularly visible on the left wall where the black strip is not parallel to the ground any more but seems to zig-zag up and down.

% To understand the issue better, let's take the example of the projection and rasterization of a quad. It is first cut into two triangles. For each triangle, all three vertices \cw{(x,y,z)} are projected into screenspace and only \cw{X=x/z,Y=y/z} remain. For each line of pixels (called scanlines), texture coordinates are interpolated linearly between line start and line end.\\
% \par
% This algorithm gives the weird-looking result featured in figure \ref{affine_texture_mapping/affine2.png}. Notice how all lines are parallel and there is no perspective (which is the main issue).\\
From the previous screenshot we can see that something is wrong but it is not clear what. There is obviously a distortion but it is not exactly what we saw on page \pageref{affine_texture_examples}. The difference is that we were able to draw a quad directly whereas the Playstation's GPU is only capable of processing triangles.\\
\par
 Without the ability to  draw quads, developers had to express everything as triangles. To draw a wall they had to place two triangles next to each other.\\
\par
\cfullimage{perspective_psx_explained.png}{Left: Affine texturing. Right: Perspective texturing}
\par
In Figure \ref{perspective_psx_explained.png}, the left wall shows how the PSX received two triangles and performed screen space affine texturing without factoring in the distance from the point of view. The result differs significantly from what it should have been as the right wall shows.\\
\par
 To rasterize these triangles the GPU has no choice but to use a scanline algorithm. The process preserves line parallelism and moreover there seems to be no "agreement" between the two triangles resulting in an unpleasant "zigzag".\\
\par
% To get texturing right and interpolate a vertex attribute correctly, it first has to be divided by its z-coordinate. Texturing can then happen via linear interpolation. Before sampling the coordinate must be multiplied by Z again. The implementation is expensive since linear interpolation has to be done between \cw{(u/z,v/z)} and the final result has to be multiplied by \cw{z}.\\
% \par
In figure \ref{texture_anmgle}, the visual artifacts become exacerbated as the angle of the wall increases. Also notice in the right column how the width of each square is always constant, a giveaway of affine texturing that contrasts with the perspective correct decreasing width seen in the left column.\\ 
\pagebreak




\par
\begin{figure}[H] \centering
\begin{minipage}{\textwidth}
\scaledimage{0.4}{affine_texture_mapping/tex_perp_pc_repeat_nearest_replace.png} \hspace{2cm}
\scaledimage{0.4}{affine_texture_mapping/tex_perp_no_pc_repeat_nearest_replace.png}\\
\par

\scaledimage{0.4}{affine_texture_mapping/tex_pc_repeat_nearest_replace.png} \hspace{2cm}
\scaledimage{0.4}{affine_texture_mapping/tex_no_pc_repeat_nearest_replace.png}\\
\par

\scaledimage{0.4}{affine_texture_mapping/tex_pc_repeat_nearest_replace_sharp.png} \hspace{2cm}
\scaledimage{0.4}{affine_texture_mapping/tex_no_pc_repeat_nearest_replace_sharp.png}\\
\par
\end{minipage}
\caption{Perspective-correct texturing (left) vs affine texture mapping (right)}
\label{texture_anmgle}
\end{figure}
\par

\pagebreak


Sony was well aware of the problem but manufacturing cost prevented gifting the PlayStation with perspective correct hardware (they also lacked a partner with strong computer graphics experience such as SGI, who deeply influenced the Nintendo 64). The PSX's developer manual's recommended way to mitigate the problem was to subdivide triangles into more triangles.\\
\par
 That may sound like running away from the problem but the PSX was capable of processing a rather high number of triangles for its time so it was not a bad suggestion. To get a satisfactory visual result however, the number of triangles had to be high.\\
\par
\scaledimage{0.95}{affine_texture_mapping/subdivision_sample.png}\\
\par
With this perspective issue, Williams Entertainment, John, and Harry had a big problem and some were really nervous about it.

\fq{Aaron was always a big ball of stress on the projects we worked together on, and this abject failure of the plan of record was giving him panicky visions of project failure.  I sort of shrugged and said "back everything up (no source control back then!), we're going to do something completely different".\\
\par
  We wound up using the hardware to render triangles that were one pixel wide columns or rows, just like the PC asm code, and it worked well.  The more common Playstation approach turned out to be tessellating  geometry in two axis, but I was always pretty happy with how Doom felt less "wiggly" than most other Playstation games of the time.}{John Carmack}\\


  \par
  % \fullimage{psx_screen_trap.png}\\

Switching from world-space triangles to screen-space pixel-wide triangles did the trick. The engine ran at 30Hz with game logic at 15Hz. The graphical result was exactly like the PC version. Running at a resolution of 256 x 240\footnote{One of the lowest resolutions used by a game; even Ridge Racer rendered at a higher resolution.}, the engine managed an impressive 20-30\footnote{Source: Digital foundry.} frames per second in most instances.\\
\par
\doom{} on PSX achieved both critical and commercial success.\\
\par 
\fq{PlayStation version succeeded in "putting previous efforts for 32X, Jaguar, and especially Super NES, to shame.}{Next Generation, 1995}\\ 
\par
Even members of id Software stepped forward to assert the quality of the port.\\
\par
\fq{This is the best DOOM yet!}{John Romero}\\
\par
\trivia{If the player took enough damage to become gibbed, the status bar head reflected the result in gory detail -- not something that would have flown with Nintendo!}
% Harry Teasley: http://5years.doomworld.com/interviews/harryteasley/\\

\pagebreak
