\section{Palette Effects}
\label{label_palettes} \label{doom_palette}
\begin{wrapfigure}[8]{r}{0.25\textwidth}
\centering
\scaledimage{0.25}{palette.png}
\end{wrapfigure}

Despite its many weaknesses, the VGA hardware had one really cool feature, its palette. Only 768 bytes were required to make the entire screen fade toward a color. \doom{} used fading for three effects -- damage, item pickup, and the radiation suit. To implement these effects, palettes were precalculated and stored in the \cw{PLAYPAL} lump. There are fourteen palettes in total. Palette \#0 was the default and was used during most of the game.\\
\par
Eight palettes (from \#1 to \#8) were used to emphasize damage and to let the player know how badly they were being injured. The effect switches the display to one of the seven palettes based on the amount of damage taken (the higher the damage the higher the starting palette). A fully red screen was usually very bad news. If no more damage is taken, the palette fades back to normal (Palette \#0) at the rate of one palette unit every 1/2 second.\\
\par
\scaledimage{0.25}{palette_damage1.png}
\scaledimage{0.25}{palette_damage2.png}
\scaledimage{0.25}{palette_damage3.png}
\scaledimage{0.25}{palette_damage4.png}
\scaledimage{0.25}{palette_damage5.png}
\scaledimage{0.25}{palette_damage6.png}
\scaledimage{0.25}{palette_damage7.png}
\scaledimage{0.25}{palette_damage8.png}\\
\par
Due to an off-by-one bug, palette \#1 is never used. Take a good look at the code selecting the damage palette in \cw{ST\_doPaletteStuff}; it can only generate values within the range [2,8].\\
\par
\ccode{ST_doPaletteStuff0.c}\\
\par
\ccode{ST_doPaletteStuff.c}\\
\par
Palettes \#9 to \#12 are used briefly when an item is picked up.\\
\par
\scaledimage{0.25}{palette_item1.png}
\scaledimage{0.25}{palette_item2.png}
\scaledimage{0.25}{palette_item3.png}
\scaledimage{0.25}{palette_item4.png}\\
\par
Because of the same off-by-one miscalculation, palette \#9 is never used. The palette selector can only generate values within range [10,12] whereas a [9,12] range was needed.\\
\par
% \ccode{ST_doPaletteStuff2.c}\\
\par
The last palette (\#13) is not used for fading effects but as a temporary swap when the player is wearing the radiation suit.\\ 
\par

\scaledimage{0.25}{palette_radiationsuit.png}
